<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Rust implementations of the AMD SEV-SNP GHCB MSR protocol."><meta name="keywords" content="rust, rustlang, rust-lang, msr"><title>sev_guest::msr - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../sev_guest/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../sev_guest/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Module msr</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></div></section><div id="sidebar-vars" data-name="msr" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../sev_guest/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Module <a href="../index.html">sev_guest</a>::<wbr><a class="mod" href="#">msr</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/sev_guest/msr.rs.html#17-641">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Rust implementations of the AMD SEV-SNP GHCB MSR protocol.</p>
<p>The protocol is implemented by writing to, and reading from, model-specific register (MSR)
0xC001_0130. The guest makes a request by writing an appropriate value to the MSR and calling
VMGEXIT. After the hypervisor processes the request and resumes the guest, the guest can read
the response from the same MSR.</p>
<p>The 12 least significant bits represent information about the operation being performed. The
remaining 52 bits represent the data for the operation. The format of the data is dependent on
the operation.</p>
<p>The MSR protocol is primarily used to set up the GHCB communications with the hypervisor.</p>
<p>See section 2.3.1 in <a href="https://developer.amd.com/wp-content/resources/56421.pdf">https://developer.amd.com/wp-content/resources/56421.pdf</a> for more detail.</p>
<p>Note: This implementation does not include the AP Reset Hold operations seeing that it is not
the preferred mechanism for starting a new application processor (AP) under AMD SEV-SNP. The
SEV-SNP AP creation NAE should be used instead. See section 4.3.2 of
<a href="https://developer.amd.com/wp-content/resources/56421.pdf">https://developer.amd.com/wp-content/resources/56421.pdf</a>.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CpuidRequest.html" title="sev_guest::msr::CpuidRequest struct">CpuidRequest</a></div><div class="item-right docblock-short"><p>A request to execute CPUID for a specific leaf and return one of the result registers.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CpuidResponse.html" title="sev_guest::msr::CpuidResponse struct">CpuidResponse</a></div><div class="item-right docblock-short"><p>A response from executing CPUID for a specific leaf. Only one register is returned at a time.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GhcbGpa.html" title="sev_guest::msr::GhcbGpa struct">GhcbGpa</a></div><div class="item-right docblock-short"><p>Contains the guest-physical address of the GHCB page. The address must have been registered with
the hypervisor before using it.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.HypervisorFeatureSupportRequest.html" title="sev_guest::msr::HypervisorFeatureSupportRequest struct">HypervisorFeatureSupportRequest</a></div><div class="item-right docblock-short"><p>A request for the hypervisor’s supported features.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.HypervisorFeatureSupportResponse.html" title="sev_guest::msr::HypervisorFeatureSupportResponse struct">HypervisorFeatureSupportResponse</a></div><div class="item-right docblock-short"><p>Flags indicating which features are supported by the hypervisor.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PreferredGhcbGpaRequest.html" title="sev_guest::msr::PreferredGhcbGpaRequest struct">PreferredGhcbGpaRequest</a></div><div class="item-right docblock-short"><p>A request for the hypervisor’s preferred location for the GHCB page.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PreferredGhcbGpaResponse.html" title="sev_guest::msr::PreferredGhcbGpaResponse struct">PreferredGhcbGpaResponse</a></div><div class="item-right docblock-short"><p>The response containing the preferred location of the GHCB.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RegisterGhcbGpaRequest.html" title="sev_guest::msr::RegisterGhcbGpaRequest struct">RegisterGhcbGpaRequest</a></div><div class="item-right docblock-short"><p>Request to register a guest-physical address for the GHCB with the hypervisor.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RegisterGhcbGpaResponse.html" title="sev_guest::msr::RegisterGhcbGpaResponse struct">RegisterGhcbGpaResponse</a></div><div class="item-right docblock-short"><p>The response containing the result of the GHCB registration.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SevInfoRequest.html" title="sev_guest::msr::SevInfoRequest struct">SevInfoRequest</a></div><div class="item-right docblock-short"><p>A request for information about the supported GHCB MSR protocol version and the encryption bit.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SevInfoResponse.html" title="sev_guest::msr::SevInfoResponse struct">SevInfoResponse</a></div><div class="item-right docblock-short"><p>Response from the hypervisor about the encryption bit and supported GHCB protocol versions. The
encryption bit value is validated by the hardware before the guest is resumed.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SnpPageStateChangeRequest.html" title="sev_guest::msr::SnpPageStateChangeRequest struct">SnpPageStateChangeRequest</a></div><div class="item-right docblock-short"><p>Request to change a memory page from shared to private or private to shared.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SnpPageStateChangeResponse.html" title="sev_guest::msr::SnpPageStateChangeResponse struct">SnpPageStateChangeResponse</a></div><div class="item-right docblock-short"><p>The response containing the result of the SNP Page State Change operation.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TerminationRequest.html" title="sev_guest::msr::TerminationRequest struct">TerminationRequest</a></div><div class="item-right docblock-short"><p>Request for the hypervisor to terminate the guest.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.CpuidRegister.html" title="sev_guest::msr::CpuidRegister enum">CpuidRegister</a></div><div class="item-right docblock-short"><p>The register of interest from the result of executing CPUID.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.PageAssignment.html" title="sev_guest::msr::PageAssignment enum">PageAssignment</a></div><div class="item-right docblock-short"><p>Whether a memory page is private to the guest, or shared with the hypervisor.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TerminationReason.html" title="sev_guest::msr::TerminationReason enum">TerminationReason</a></div><div class="item-right docblock-short"><p>The reason for requesting termination from the hypervisor.</p>
</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.NO_PREFERRED_GHCB_LOCATION.html" title="sev_guest::msr::NO_PREFERRED_GHCB_LOCATION constant">NO_PREFERRED_GHCB_LOCATION</a></div><div class="item-right docblock-short"><p>Value indicating that the hypervisor does not have a preferred location for the GHCB.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.SUPPORTED_PROTOCOL_VERION.html" title="sev_guest::msr::SUPPORTED_PROTOCOL_VERION constant">SUPPORTED_PROTOCOL_VERION</a></div><div class="item-right docblock-short"><p>The version of the GHCB MSR protocol supported by this library. This represents the version
specific to AMD SEV-SNP.</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.change_snp_page_state.html" title="sev_guest::msr::change_snp_page_state fn">change_snp_page_state</a></div><div class="item-right docblock-short"><p>Requests a change of state for a page to be either private to the guest VM, or shared with the
hypervisor.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_cpuid.html" title="sev_guest::msr::get_cpuid fn">get_cpuid</a></div><div class="item-right docblock-short"><p>Gets the value of the specified register that was returned when executing CPUID for the
specified leaf. Sub-leafs are not supported.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_hypervisor_feature_support.html" title="sev_guest::msr::get_hypervisor_feature_support fn">get_hypervisor_feature_support</a></div><div class="item-right docblock-short"><p>Requests a bitmap specifying the features supported by the hypervisor.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_preferred_ghcb_location.html" title="sev_guest::msr::get_preferred_ghcb_location fn">get_preferred_ghcb_location</a></div><div class="item-right docblock-short"><p>Requests the hypervisor’s preferred location for the GHCB page.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_sev_info.html" title="sev_guest::msr::get_sev_info fn">get_sev_info</a></div><div class="item-right docblock-short"><p>Gets information about the supported GHCB MSR protocol verions and the location of the
encryption bit.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.read_msr.html" title="sev_guest::msr::read_msr fn">read_msr</a></div><div class="item-right docblock-short"><p>Reads the value of the model-specific register.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.register_ghcb_location.html" title="sev_guest::msr::register_ghcb_location fn">register_ghcb_location</a></div><div class="item-right docblock-short"><p>Registers the location of the GHCB page for the current vCPU with the hypervisor.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.request_termination.html" title="sev_guest::msr::request_termination fn">request_termination</a></div><div class="item-right docblock-short"><p>Requests termination from the hypervisor.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.set_ghcb_address_and_exit.html" title="sev_guest::msr::set_ghcb_address_and_exit fn">set_ghcb_address_and_exit</a></div><div class="item-right docblock-short"><p>Sets the address of the GHCB page before exiting to the hypervisor.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.write_msr_and_exit.html" title="sev_guest::msr::write_msr_and_exit fn">write_msr_and_exit</a></div><div class="item-right docblock-short"><p>Writes a value to the MSR and calls VMGEXIT to hand control to the hypervisor.</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="sev_guest" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.0-nightly (de1bc0008 2022-04-21)" ></div>
</body></html>