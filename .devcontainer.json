// See
//
// - https://code.visualstudio.com/docs/remote/containers
// - https://code.visualstudio.com/docs/remote/devcontainerjson-reference
{
  // Do not modify manually. This value is automatically updated by ./scripts/docker_build .
  "image": "sha256:399178a115bda5b421a7515cb4108e776b5fd936413adfbf042932db3c93938d",
  "extensions": [
    "13xforever.language-x86-64-assembly",
    "bazelbuild.vscode-bazel",
    "bodil.prettier-toml",
    "bungcip.better-toml",
    "esbenp.prettier-vscode",
    "vadimcn.vscode-lldb",
    "xaver.clang-format",
    "zixuanwang.linkerscript",
    "zxh404.vscode-proto3",
    "rust-lang.rust-analyzer",
    "fabiospampinato.vscode-open-in-github",
    "waderyan.gitblame"
  ],
  "mounts": [
    // Crosvm wants access to syslog.
    "source=/dev/log,target=/dev/log,type=bind"
  ],
  // Before creating the container, generate a .env file for the variables that
  // should be set within the container.
  "initializeCommand": "./scripts/docker_create_env_file",
  "runArgs": [
    // Use the .env file generated prior to container creation.
    "--env-file=.docker.env",
    // Required by crosvm.
    "--device=/dev/kvm"
  ],
  "settings": {
    // Use the `rust-analyzer` binary installed in the Docker image.
    "rust-analyzer.serverPath": "rust-analyzer",
    // Ensure protobuf generated files are loaded correctly.
    "rust-analyzer.cargo.loadOutDirsFromCheck": true
  },
  // Ensure that the workspace is mounted consistently with the `/docker_run` script.
  // See https://code.visualstudio.com/docs/remote/containers-advanced#_changing-the-default-source-code-mount.
  "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=delegated",
  "workspaceFolder": "/workspace",
  // Do not alter the user used to run the image, as permission setting is
  // already handled in our docker image's entrypoint script.
  "containerUser": "docker",
  "updateRemoteUserUID": false,
  "remoteUser": "docker"
}
